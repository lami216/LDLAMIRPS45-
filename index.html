<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù„Ø¹Ø¨Ø© Ø­Ø¬Ø±Ø© ÙˆØ±Ù‚Ø© Ù…Ù‚Øµ</title>
  <style>
    body{
      font-family: Arial, sans-serif;direction:rtl;background:linear-gradient(135deg,#e0eafc,#cfdef3);
      margin:0;padding:0;overflow-x:hidden
    }
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
    #controls{
      padding:10px;background:#2c3e50;text-align:center;box-shadow:0 4px 6px rgba(0,0,0,.2);position:relative
    }
    .btn{
      padding:10px 14px;font-size:14px;margin:0 6px;cursor:pointer;border:0;border-radius:8px;
      background:#3498db;color:#fff;font-weight:bold;transition:.25s
    }
    .btn:hover{background:#2980b9;transform:scale(1.04)}
    .input{
      padding:9px 10px;border-radius:8px;border:0;margin:0 6px;font-weight:bold
    }
    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .menu{position:absolute;background:#1f2a36;border-radius:8px;box-shadow:0 8px 20px rgba(0,0,0,.25);display:none}
    .menu button{display:block;width:100%;text-align:right;background:transparent;border:0;color:#fff;padding:10px 12px}
    .menu button:hover{background:#2c3e50}
    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª */
    #stats{
      padding:8px 12px;background:#34495e;color:#fff;display:flex;gap:18px;align-items:center;justify-content:center;
      font-size:18px;font-weight:bold;border-bottom:3px solid #2c3e50
    }
    #stats .item{display:flex;align-items:center;gap:6px}
    /* Ø§Ù„Ø­Ù„Ø¨Ø© */
    #arena{
      width:100%;height:600px;background:#fff;position:relative;overflow:hidden;border:3px solid #2c3e50;border-radius:12px;margin-top:10px
    }
    .entity{
      position:absolute;font-size:20px;width:24px;height:24px;text-align:center;user-select:none;will-change:left,top,transform
    }
    /* Ø´Ø§Ø´Ø© Ø§Ù„ÙØ§Ø¦Ø² */
    #winnerScreen{
      position:absolute;inset:0;background:rgba(255,255,255,.9);display:flex;flex-direction:column;justify-content:center;align-items:center;
      z-index:100;opacity:0;transition:opacity .8s ease;pointer-events:none
    }
    #winnerScreen.show{opacity:1}
    #winnerEmoji{font-size:120px;animation:pulse 1s infinite alternate;position:relative;z-index:150}
    #winnerText{font-size:36px;font-weight:bold;margin-top:10px;color:#2c3e50;position:relative;z-index:150}
    @keyframes pulse{from{transform:scale(1)}to{transform:scale(1.15)}}
    /* Ø§Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù„Ø¨Ø© ÙÙ‚Ø· */
    .confetti{position:absolute;width:10px;height:10px;opacity:.95;z-index:200;border-radius:2px}
    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‡Ø¯Ù (Ù‡Ø¯ÙŠØ©) */
    #goalBox{
      position:absolute;top:10px;left:10px;background:#ff8a00;color:#fff;border-radius:12px;padding:8px 10px;display:flex;align-items:center;gap:8px;z-index:220;
      box-shadow:0 6px 16px rgba(0,0,0,.25);font-weight:bold
    }
    #goalBox .gift{font-size:20px}
    #goalBox .pct{background:#fff;color:#ff8a00;font-weight:900;border-radius:8px;padding:4px 8px;min-width:48px;text-align:center}
    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ù…ÙˆÙ‚Ø¹Ù‡Ø§ ØªØ­Øª Ø²Ø± Ø§Ù„Ø³Ø±Ø¹Ø© */
    #speedMenu{min-width:120px;right:10px;top:50px}
    /* ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© */
    #signatureWrap{display:flex;justify-content:center;align-items:center;margin:14px 0 24px}
    #signatureWrap img{max-width:92%;height:auto;opacity:.95}
  </style>
</head>
<body>

  <div id="controls">
    <button id="startBtn" class="btn">Ø¨Ø¯Ø¡ â–¶ï¸</button>
    <button id="endBtn" class="btn" style="background:#e74c3c">Ø¥Ù†Ù‡Ø§Ø¡ â›”</button>

    <!-- Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„ÙƒÙ„ Ù†ÙˆØ¹ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 12) -->
    <label style="color:#fff;margin:0 6px">Ø§Ù„Ø¹Ø¯Ø¯/Ù†ÙˆØ¹:
      <input id="countInput" class="input" type="number" min="1" max="300" value="12" style="width:80px">
    </label>

    <!-- Ø²Ø± Ø§Ù„Ø³Ø±Ø¹Ø© Ø¨Ù‚Ø§Ø¦Ù…Ø© -->
    <button id="speedBtn" class="btn" style="background:#f39c12">âš¡ Ø§Ù„Ø³Ø±Ø¹Ø©: <span id="speedLabel">1.5x</span></button>
    <div id="speedMenu" class="menu">
      <button data-speed="1">1x</button>
      <button data-speed="1.25">1.25x</button>
      <button data-speed="1.5">1.5x</button>
      <button data-speed="1.75">1.75x</button>
      <button data-speed="2">2x</button>
      <button data-speed="3">3x</button>
    </div>
  </div>

  <div id="stats">
    <div class="item">ğŸª¨ <span id="rockCount">0</span></div>
    <div class="item">âœ‚ï¸ <span id="scissorsCount">0</span></div>
    <div class="item">ğŸ“„ <span id="paperCount">0</span></div>
    <div class="item">ğŸ† <span id="lastWinner">-</span></div>
  </div>

  <div id="arena">
    <div id="goalBox"><span class="gift">ğŸ</span><span>Ø§Ù„Ø­Ø¸ Ø§Ù„Ù…ØªÙˆØ§ØµÙ„</span><span id="goalPct" class="pct">0%</span></div>
    <div id="winnerScreen">
      <div id="winnerEmoji"></div>
      <div id="winnerText">ğŸ† Ø§Ù„Ø¨Ø·Ù„ ğŸ†</div>
    </div>
  </div>

  <!-- ØµÙˆØ±Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø£Ø³ÙÙ„ Ø§Ù„Ø­Ù„Ø¨Ø© -->
  <div id="signatureWrap">
    <img src="Signature.png" alt="Signature">
  </div>

  <!-- ØµÙˆØª Ø§Ù„ÙÙˆØ² -->
  <audio id="victorySound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>

<script>
  const arena = document.getElementById("arena");
  const lastWinner = document.getElementById("lastWinner");
  const winnerScreen = document.getElementById("winnerScreen");
  const winnerEmoji = document.getElementById("winnerEmoji");
  const victorySound = document.getElementById("victorySound");
  const goalPctEl = document.getElementById("goalPct");

  const startBtn = document.getElementById("startBtn");
  const endBtn = document.getElementById("endBtn");
  const countInput = document.getElementById("countInput");

  const speedBtn = document.getElementById("speedBtn");
  const speedMenu = document.getElementById("speedMenu");
  const speedLabel = document.getElementById("speedLabel");

  // Ø§Ù„Ø³Ø±Ø¹Ø©
  let speedFactor = 1.5;

  // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
  let gameRunning = false;
  let animationFrameId;

  // Ø§Ù„ÙƒÙŠØ§Ù†Ø§Øª
  const emojis = { rock:"ğŸª¨", paper:"ğŸ“„", scissors:"âœ‚ï¸" };
  const beatMap = { rock:"scissors", scissors:"paper", paper:"rock" };
  let counts = { rock:0, paper:0, scissors:0 };
  let entities = [];

  // Ø§Ù„ØµÙˆØªÙŠØ§Øª (Ù…Ù„ÙØ§ØªÙƒ Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø¬Ø§Ù†Ø¨ index.html)
  const soundURLs = {
    rock: "Rock.mp3",
    paper: "Paper.mp3",
    scissors: "scissor.mp3"
  };

  // ØªØ´ØºÙŠÙ„ ØµÙˆØª Ø§Ù„ØªØµØ§Ø¯Ù… = ØµÙˆØª Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ§Ø¦Ø² / Ø£Ùˆ Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹
  function playHit(type){
    const url = soundURLs[type];
    if(!url) return;
    try{
      const a = new Audio(url);
      a.volume = 0.75;
      a.play().catch(()=>{});
    }catch(_){}
  }

  // Ù‡Ø¯Ù: ØªØªØ¨Ù‘Ø¹ ÙÙˆØ² Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ Ø¹Ù„Ù‰ Ø§Ù„ØªÙˆØ§Ù„ÙŠ
  let lastRoundWinner = null;
  let winnerStreak = 0; // 0..10

  function updateGoalUI(){
    const pct = Math.min(winnerStreak,10)*10;
    goalPctEl.textContent = pct + "%";
  }

  function announceJackpot(){
    alert("ğŸ Ø§Ù„ÙƒÙˆØ¯: 41380130\nÙ„Ù‚Ø¯ ÙØ²Øª Ù…Ø¹Ù†Ø§ Ø¨Ø¬Ø§Ø¦Ø²Ø© Ù‚Ø¯Ø±Ù‡Ø§ 1000 Ø£ÙˆÙ‚ÙŠØ© Ù…Ù‚Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ± Ø¹Ù„Ù‰ Ø±ÙˆØ¹Ø© Ø­Ø¸Ùƒ!");
  }

  // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø±Ø¹Ø©
  speedBtn.addEventListener("click", () => {
    speedMenu.style.display = speedMenu.style.display === "block" ? "none" : "block";
  });
  document.addEventListener("click",(e)=>{
    if(!speedBtn.contains(e.target) && !speedMenu.contains(e.target)){
      speedMenu.style.display="none";
    }
  });
  speedMenu.querySelectorAll("button").forEach(btn=>{
    btn.onclick = ()=>{
      speedFactor = parseFloat(btn.dataset.speed);
      speedLabel.textContent = btn.textContent;
      speedMenu.style.display="none";
    };
  });

  function getRandomPosition(){
    return {
      x: Math.random() * (arena.clientWidth - 24),
      y: Math.random() * (arena.clientHeight - 24)
    };
  }

  function createEntity(type){
    const div = document.createElement("div");
    div.className = "entity";
    div.dataset.type = type;
    div.textContent = emojis[type];

    const {x,y} = getRandomPosition();
    div.style.left = x+"px";
    div.style.top = y+"px";
    arena.appendChild(div);

    let baseDx = (Math.random()*2 - 1) || 0.6;
    let baseDy = (Math.random()*2 - 1) || -0.6;

    entities.push({ el:div, x, y, baseDx, baseDy });
    counts[type]++;
  }

  function updateCounts(){
    document.getElementById("rockCount").textContent = counts.rock;
    document.getElementById("paperCount").textContent = counts.paper;
    document.getElementById("scissorsCount").textContent = counts.scissors;
  }

  function rectOf(e){ return e.el.getBoundingClientRect(); }

  function checkCollision(a,b){
    const r1 = rectOf(a), r2 = rectOf(b);
    return !(r1.right<r2.left || r1.left>r2.right || r1.bottom<r2.top || r1.top>r2.bottom);
  }

  // Ø¯ÙØ¹Ø© Ù…ØªØ¹Ø§ÙƒØ³Ø© Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„ØªØµØ§Ø¯Ù…
  function knockback(a,b){
    const ax=a.x+12, ay=a.y+12, bx=b.x+12, by=b.y+12;
    let nx=ax-bx, ny=ay-by; const len=Math.hypot(nx,ny)||1; nx/=len; ny/=len;
    const base=1.2*speedFactor, jitter=0.25;
    a.baseDx =  nx*base + (Math.random()*jitter - jitter/2);
    a.baseDy =  ny*base + (Math.random()*jitter - jitter/2);
    b.baseDx = -nx*base + (Math.random()*jitter - jitter/2);
    b.baseDy = -ny*base + (Math.random()*jitter - jitter/2);
    const sep=3; a.x+=nx*sep; a.y+=ny*sep; b.x-=nx*sep; b.y-=ny*sep;
  }

  function rpsResolve(a,b){
    let aType=a.el.dataset.type, bType=b.el.dataset.type;

    if(aType===bType){
      playHit(aType);  // Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ = Ù†ÙØ³ Ø§Ù„ØµÙˆØª
      return;
    }
    if(beatMap[aType]===bType){
      counts[bType]--; b.el.dataset.type=aType; b.el.textContent=emojis[aType];
      counts[aType]++; updateCounts(); playHit(aType);
    }else if(beatMap[bType]===aType){
      counts[aType]--; a.el.dataset.type=bType; a.el.textContent=emojis[bType];
      counts[bType]++; updateCounts(); playHit(bType);
    }
  }

  function animate(){
    if(!gameRunning) return;

    // Ø­Ø±ÙƒØ©
    entities.forEach(e=>{
      let dx=e.baseDx*speedFactor, dy=e.baseDy*speedFactor;
      e.x+=dx; e.y+=dy;
      if(e.x<=0 || e.x>=arena.clientWidth-24){ e.baseDx*=-1; e.x=Math.min(Math.max(e.x,0),arena.clientWidth-24); }
      if(e.y<=0 || e.y>=arena.clientHeight-24){ e.baseDy*=-1; e.y=Math.min(Math.max(e.y,0),arena.clientHeight-24); }
      e.el.style.left=e.x+"px"; e.el.style.top=e.y+"px";
    });

    // Ø§Ù„ØªØµØ§Ø¯Ù…Ø§Øª
    for(let i=0;i<entities.length;i++){
      for(let j=i+1;j<entities.length;j++){
        const a=entities[i], b=entities[j];
        if(checkCollision(a,b)){
          knockback(a,b);
          rpsResolve(a,b);
        }
      }
    }

    // ØªØ­Ù‚Ù‚ ÙØ§Ø¦Ø² Ø§Ù„Ø¬ÙˆÙ„Ø©
    const aliveTypes = Object.keys(counts).filter(t=>counts[t]>0);
    if(aliveTypes.length===1){
      gameRunning=false; cancelAnimationFrame(animationFrameId);
      const winnerType = aliveTypes[0];

      // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù‡Ø¯Ù Ø¹Ù†Ø¯ ØªØºÙŠÙ‘Ø± Ø§Ù„ÙØ§Ø¦Ø² Ø¹Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚ØŒ Ø£Ùˆ Ø²ÙŠØ§Ø¯Ø© Ù„Ùˆ Ù†ÙØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚
      if(lastRoundWinner===winnerType){ 
        winnerStreak++; 
      } else { 
        winnerStreak = 1;  // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙˆØ¨Ø¯Ø§ÙŠØ© Ù…Ù† 1 Ù„Ù„ÙØ§Ø¦Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯
      }
      lastRoundWinner = winnerType; 
      updateGoalUI();
      if(winnerStreak===10){ announceJackpot(); }

      showWinner(winnerType);
      return;
    }

    animationFrameId = requestAnimationFrame(animate);
  }

  // ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù„Ø¨Ø© ÙÙ‚Ø· ÙˆÙŠÙ‚Ù Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø§Ø¹
  function spawnConfettiOverWinner(){
    const hostRect = winnerEmoji.getBoundingClientRect();
    const arenaRect = arena.getBoundingClientRect();
    const originX = (hostRect.left + hostRect.right)/2 - arenaRect.left;
    const originTop = (hostRect.top - arenaRect.top) + 10;
    const colors=["#e74c3c","#2ecc71","#3498db","#f1c40f","#9b59b6"];
    for(let i=0;i<60;i++){
      const c=document.createElement("div");
      c.className="confetti";
      c.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];
      const startX=originX-80+Math.random()*160;
      const startY=Math.max(0, originTop-40+Math.random()*20);
      c.style.left=startX+"px"; c.style.top=startY+"px";
      arena.appendChild(c);
      let vy=2+Math.random()*2, vx=(Math.random()-0.5)*1.2, rot=(Math.random()<0.5?-1:1)*(1+Math.random()*2), ang=0;
      const fall=setInterval(()=>{
        let y=parseFloat(c.style.top), x=parseFloat(c.style.left);
        y+=vy; x+=vx; ang+=rot;
        c.style.top=y+"px"; c.style.left=x+"px"; c.style.transform=`rotate(${ang}deg)`;
        if(y>=arena.clientHeight-12){ c.style.top=(arena.clientHeight-12)+"px"; clearInterval(fall); }
      },16);
      setTimeout(()=>{ try{c.remove()}catch(_){}} , 8000);
    }
  }

  function showWinner(type){
    entities.forEach(e=> e.el.style.opacity="0");
    setTimeout(()=>{
      winnerEmoji.textContent = {rock:"ğŸª¨",paper:"ğŸ“„",scissors:"âœ‚ï¸"}[type];
      winnerScreen.classList.add("show");
      lastWinner.textContent = type==="rock"?"Ø­Ø¬Ø±":type==="paper"?"ÙˆØ±Ù‚Ø©":"Ù…Ù‚Øµ";
      try{ victorySound.currentTime=0; victorySound.play().catch(()=>{});}catch(_){}
      spawnConfettiOverWinner();
    },400);
  }

  function clearArena(){
    arena.querySelectorAll(".entity").forEach(el=>el.remove());
    arena.querySelectorAll(".confetti").forEach(c=>c.remove());
    entities=[]; counts={rock:0,paper:0,scissors:0};
    updateCounts(); winnerScreen.classList.remove("show");
    winnerEmoji.textContent=""; lastWinner.textContent="-";
  }

  function startGame(){
    if(gameRunning) return;
    clearArena();

    // ØªÙˆØ²ÙŠØ¹ Ø¨Ø¹Ø¯Ø¯ Ù…Ø®ØµÙ‘Øµ Ù„ÙƒÙ„ Ù†ÙˆØ¹ (Ø§ÙØªØ±Ø§Ø¶ÙŠ 12)
    const perType = Math.max(1, parseInt(countInput.value || "12",10));
    ["rock","paper","scissors"].forEach(t=>{
      for(let i=0;i<perType;i++) createEntity(t);
    });
    updateCounts();

    gameRunning=true; animate();
  }

  function endGame(){
    gameRunning=false; cancelAnimationFrame(animationFrameId); clearArena();
  }

  startBtn.onclick = startGame;
  endBtn.onclick   = endGame;

  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù‡Ø¯Ù Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  updateGoalUI();
</script>
</body>
</html>
